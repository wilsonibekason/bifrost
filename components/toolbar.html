<div class="toolbar-container">
  <!-- Window Controls (macOS style) -->
  <div
    class="flex items-center justify-between bg-zinc-800 px-3 py-2 toolbar-drag-region"
  >
    <!-- Left: Window Controls -->
    <div class="flex items-center space-x-2 no-drag">
      <div class="flex space-x-2">
        <button
          onclick="window.__TAURI__?.window?.getCurrent().close()"
          class="w-3 h-3 rounded-full bg-red-500 hover:bg-red-600 transition"
        ></button>
        <button
          onclick="window.__TAURI__?.window?.getCurrent().minimize()"
          class="w-3 h-3 rounded-full bg-yellow-500 hover:bg-yellow-600 transition"
        ></button>
        <button
          onclick="window.__TAURI__?.window?.getCurrent().toggleMaximize()"
          class="w-3 h-3 rounded-full bg-green-500 hover:bg-green-600 transition"
        ></button>
      </div>
    </div>

    <!-- Center: Atlas Logo/Title -->
    <div class="text-xs font-semibold text-zinc-400 select-none">
      Atlas Browser
    </div>

    <!-- Right: Utility Icons -->
    <div class="flex items-center space-x-3 no-drag">
      <!-- Location Intelligence Indicator -->
      <button
        class="icon hover:text-blue-400 transition"
        title="Location: Ibadan, NG"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
          />
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
          />
        </svg>
      </button>

      <!-- Privacy Shield -->
      <button
        class="icon text-green-500 hover:text-green-400 transition"
        title="Privacy Protection: Active"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"
          />
        </svg>
      </button>

      <!-- Extensions/Plugins -->
      <button class="icon hover:text-zinc-300 transition" title="Extensions">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 00-1-1H4a2 2 0 110-4h1a1 1 0 001-1V7a1 1 0 011-1h3a1 1 0 001-1V4z"
          />
        </svg>
      </button>

      <!-- User Profile -->
      <button class="icon hover:text-zinc-300 transition" title="User Profile">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
          />
        </svg>
      </button>

      <!-- Theme Toggle Button -->
      <button
        id="theme-toggle"
        onclick="toggleTheme()"
        class="icon hover:text-blue-400 transition"
        title="Toggle Theme"
      >
        <svg
          id="theme-icon-light"
          class="hidden"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
          />
        </svg>
        <svg
          id="theme-icon-dark"
          class="hidden"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
          />
        </svg>
      </button>
    </div>
  </div>

  <!-- Tab Bar -->
  <div
    id="tab-bar"
    class="flex items-center bg-zinc-900 px-2 py-1 overflow-x-auto no-drag"
  >
    <!-- Tabs will be loaded here -->
    <div class="flex items-center space-x-1 flex-1">
      <!-- Tabs will be dynamically rendered by TabManager -->
    </div>

    <!-- New Tab Button -->
    <button
      onclick="window.createNewTab()"
      class="ml-2 p-1.5 rounded hover:bg-zinc-700 transition"
      title="New Tab"
    >
      <svg
        class="w-5 h-5 text-zinc-400"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M12 4v16m8-8H4"
        />
      </svg>
    </button>
  </div>

  <!-- Navigation Bar -->
  <div class="flex items-center space-x-2 bg-zinc-800 px-3 py-2 no-drag">
    <!-- Navigation Controls -->
    <div class="flex items-center space-x-1">
      <button
        class="p-2 rounded hover:bg-zinc-700 transition disabled:opacity-50"
        disabled
        title="Back"
      >
        <svg
          class="w-5 h-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 19l-7-7 7-7"
          />
        </svg>
      </button>
      <button
        class="p-2 rounded hover:bg-zinc-700 transition disabled:opacity-50"
        disabled
        title="Forward"
      >
        <svg
          class="w-5 h-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 5l7 7-7 7"
          />
        </svg>
      </button>
      <button class="p-2 rounded hover:bg-zinc-700 transition" title="Reload">
        <svg
          class="w-5 h-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
          />
        </svg>
      </button>
    </div>

    <!-- Address Bar -->
    <div class="flex-1 relative">
      <div
        class="flex items-center bg-zinc-900 rounded-lg px-3 py-2 focus-within:ring-2 focus-within:ring-blue-500"
      >
        <!-- Security Icon -->
        <svg
          class="w-4 h-4 text-green-500 mr-2"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"
          />
        </svg>

        <!-- URL Input -->
        <input
          type="text"
          id="address-bar"
          value="untitledui.com"
          class="flex-1 bg-transparent text-sm text-zinc-100 placeholder-zinc-500 focus:outline-none"
          placeholder="Search or enter address"
        />

        <!-- Atlas Companion Icon -->
        <button
          class="ml-2 p-1 rounded hover:bg-zinc-700 transition"
          title="Atlas Companion"
        >
          <svg
            class="w-4 h-4 text-blue-400"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M13 10V3L4 14h7v7l9-11h-7z"
            />
          </svg>
        </button>

        <!-- Bookmark Star -->
        <button
          class="ml-2 p-1 rounded hover:bg-zinc-700 transition"
          title="Bookmark this page"
        >
          <svg
            class="w-4 h-4 text-zinc-400 hover:text-yellow-400"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"
            />
          </svg>
        </button>
      </div>
    </div>

    <!-- Right Actions -->
    <div class="flex items-center space-x-2">
      <!-- History Button with Dropdown -->
      <button
        onclick="toggleHistoryDropdown()"
        class="p-2 rounded hover:bg-zinc-700 transition relative"
        title="History"
      >
        <svg
          class="w-5 h-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
          />
        </svg>
      </button>

      <!-- Bookmarks Button with Dropdown -->
      <button
        onclick="toggleBookmarksDropdown()"
        class="p-2 rounded hover:bg-zinc-700 transition relative"
        title="Bookmarks"
      >
        <svg
          class="w-5 h-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"
          />
        </svg>
      </button>

      <!-- Downloads -->
      <button
        onclick="window.showPanel('downloads')"
        class="p-2 rounded hover:bg-zinc-700 transition relative"
        title="Downloads"
      >
        <svg
          class="w-5 h-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"
          />
        </svg>
        <span
          class="absolute -top-1 -right-1 bg-blue-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center"
          >1</span
        >
      </button>

      <!-- Menu Button -->
      <button
        onclick="toggleMainMenu()"
        class="p-2 rounded hover:bg-zinc-700 transition relative"
        title="Menu"
      >
        <svg
          class="w-5 h-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"
          />
        </svg>
      </button>
    </div>
  </div>

  <!-- Bookmarks Bar -->
  <div
    id="bookmarks-bar"
    class="bg-zinc-800 px-3 py-1.5 flex items-center space-x-3 text-xs overflow-x-auto no-drag border-t border-zinc-700"
  >
    <button
      class="flex items-center space-x-1 px-2 py-1 rounded hover:bg-zinc-700 transition whitespace-nowrap"
    >
      <svg
        class="w-3 h-3 text-zinc-400"
        fill="currentColor"
        viewBox="0 0 20 20"
      >
        <path
          d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"
        />
      </svg>
      <span class="text-zinc-300">Work</span>
    </button>
    <button
      class="px-2 py-1 rounded hover:bg-zinc-700 transition text-zinc-300 whitespace-nowrap"
    >
      GitHub
    </button>
    <button
      class="px-2 py-1 rounded hover:bg-zinc-700 transition text-zinc-300 whitespace-nowrap"
    >
      Documentation
    </button>
    <button
      class="px-2 py-1 rounded hover:bg-zinc-700 transition text-zinc-300 whitespace-nowrap"
    >
      Design Resources
    </button>
    <button
      class="ml-auto p-1 rounded hover:bg-zinc-700 transition"
      title="Manage Bookmarks"
    >
      <svg
        class="w-4 h-4 text-zinc-400"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M12 4v16m8-8H4"
        />
      </svg>
    </button>
  </div>

  <!-- Main Menu Dropdown (Hidden by default) -->
  <div
    id="main-menu-dropdown"
    class="hidden absolute top-16 right-3 bg-zinc-800 rounded-lg shadow-2xl border border-zinc-700 w-72 z-50 no-drag dropdown-enter"
  >
    <div class="py-2">
      <!-- Notes -->
      <button
        onclick="window.showPanel('notes')"
        class="flex items-center space-x-3 w-full px-4 py-2.5 hover:bg-zinc-700 transition text-left"
      >
        <svg
          class="w-5 h-5 text-zinc-300"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
          />
        </svg>
        <span class="text-sm text-zinc-100">Show Notes</span>
      </button>

      <!-- Tasks -->
      <button
        onclick="window.showPanel('tasks')"
        class="flex items-center space-x-3 w-full px-4 py-2.5 hover:bg-zinc-700 transition text-left"
      >
        <svg
          class="w-5 h-5 text-zinc-300"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002-2h2a2 2 0 002 2M9 5a2 2 0 012-2h2a2 2 0 012 2"
          />
        </svg>
        <span class="text-sm text-zinc-100">Show Tasks</span>
      </button>

      <hr class="my-2 border-zinc-700" />

      <!-- Downloads -->
      <button
        onclick="window.showPanel('downloads')"
        class="flex items-center space-x-3 w-full px-4 py-2.5 hover:bg-zinc-700 transition text-left"
      >
        <svg
          class="w-5 h-5 text-zinc-300"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"
          />
        </svg>
        <span class="text-sm text-zinc-100">Downloads</span>
      </button>

      <!-- Bookmarks -->
      <button
        onclick="window.showPanel('bookmarks')"
        class="flex items-center space-x-3 w-full px-4 py-2.5 hover:bg-zinc-700 transition text-left"
      >
        <svg
          class="w-5 h-5 text-zinc-300"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"
          />
        </svg>
        <span class="text-sm text-zinc-100">Bookmarks</span>
      </button>

      <!-- History -->
      <button
        onclick="window.showPanel('history')"
        class="flex items-center space-x-3 w-full px-4 py-2.5 hover:bg-zinc-700 transition text-left"
      >
        <svg
          class="w-5 h-5 text-zinc-300"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
          />
        </svg>
        <span class="text-sm text-zinc-100">History</span>
      </button>

      <hr class="my-2 border-zinc-700" />

      <!-- Settings -->
      <button
        onclick="window.showPanel('settings')"
        class="flex items-center space-x-3 w-full px-4 py-2.5 hover:bg-zinc-700 transition text-left"
      >
        <svg
          class="w-5 h-5 text-zinc-300"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c-.94 1.543.826 3.31 2.37 2.37.996.608 2.296.07 2.572-1.065z"
          />
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
          />
        </svg>
        <span class="text-sm text-zinc-100">Settings</span>
      </button>
    </div>
  </div>

  <!-- History Dropdown Container -->
  <div
    id="history-dropdown"
    class="hidden absolute top-16 right-32 bg-zinc-800 rounded-lg shadow-2xl border border-zinc-700 w-80 max-h-96 overflow-y-auto z-50 no-drag"
  >
    <div class="p-4">
      <h3 class="text-sm font-semibold text-zinc-100 mb-3">Recent History</h3>
      <div class="space-y-2">
        <div class="text-xs text-zinc-400 text-center py-4">No history yet</div>
      </div>
    </div>
  </div>

  <!-- Bookmarks Dropdown Container -->
  <div
    id="bookmarks-dropdown"
    class="hidden absolute top-16 right-20 bg-zinc-800 rounded-lg shadow-2xl border border-zinc-700 w-80 max-h-96 overflow-y-auto z-50 no-drag"
  >
    <div class="p-4">
      <h3 class="text-sm font-semibold text-zinc-100 mb-3">Bookmarks</h3>
      <div class="space-y-2">
        <div class="text-xs text-zinc-400 text-center py-4">
          No bookmarks yet
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function toggleTheme() {
    const html = document.documentElement;
    const isDark = html.classList.contains("dark");

    if (isDark) {
      html.classList.remove("dark");
      localStorage.setItem("theme", "light");
    } else {
      html.classList.add("dark");
      localStorage.setItem("theme", "dark");
    }

    updateThemeIcon();
    console.log("[v0] Theme toggled to:", isDark ? "light" : "dark");
  }

  function updateThemeIcon() {
    const html = document.documentElement;
    const isDark = html.classList.contains("dark");
    const lightIcon = document.getElementById("theme-icon-light");
    const darkIcon = document.getElementById("theme-icon-dark");

    if (lightIcon && darkIcon) {
      if (isDark) {
        lightIcon.classList.remove("hidden");
        darkIcon.classList.add("hidden");
      } else {
        lightIcon.classList.add("hidden");
        darkIcon.classList.remove("hidden");
      }
    }
  }

  // Initialize theme on load
  function initializeTheme() {
    const savedTheme = localStorage.getItem("theme");

    // Default to dark mode if no preference is saved
    if (savedTheme === "light") {
      document.documentElement.classList.remove("dark");
    } else {
      document.documentElement.classList.add("dark");
    }

    updateThemeIcon();
    console.log("[v0] Theme initialized to:", savedTheme || "dark (default)");
  }

  function toggleMainMenu() {
    const menu = document.getElementById("main-menu-dropdown");
    menu.classList.toggle("hidden");
  }

  // Close menu when clicking outside
  document.addEventListener("click", function (event) {
    const menu = document.getElementById("main-menu-dropdown");
    const menuButton = event.target.closest('[onclick="toggleMainMenu()"]');

    if (!menuButton && !menu?.contains(event.target)) {
      menu?.classList.add("hidden");
    }
  });

  function toggleHistoryDropdown() {
    const dropdown = document.getElementById("history-dropdown");
    dropdown.classList.toggle("hidden");
  }

  function toggleBookmarksDropdown() {
    const dropdown = document.getElementById("bookmarks-dropdown");
    dropdown.classList.toggle("hidden");
  }
</script>
